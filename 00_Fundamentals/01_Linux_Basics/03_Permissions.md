# 03_Permissions

리눅스의 다중 사용자 환경에서 파일과 프로세스에 대한 접근 제어(Access Control)를 다룬다.
기본적인 rwx 권한뿐만 아니라, 해킹의 핵심 경로가 되는 특수 권한(SUID)을 중점적으로 이해해야 한다.

---

## 1. Standard Permissions (UGO & RWX)

리눅스 권한은 대상(Who)과 행위(What)로 나뉜다. `ls -l` 명령어로 확인 가능하다.

### 권한 대상 (Who)
| 표기 | 명칭 | 설명 |
| :---: | :--- | :--- |
| **u** | **User** (Owner) | 파일의 소유자. |
| **g** | **Group** | 파일 소유 그룹에 속한 사용자들. |
| **o** | **Others** | 소유자도 아니고, 그룹에도 속하지 않은 제3자. |

### 권한 행위 (What) - 파일 vs 디렉토리
파일과 디렉토리에서 r, w, x가 가지는 의미가 미묘하게 다르다.

| 모드 | 값 | 파일(File)에서의 의미 | 디렉토리(Directory)에서의 의미 |
| :---: | :---: | :--- | :--- |
| **r** | 4 | 내용을 읽을 수 있음 (`cat`) | 디렉토리 목록을 볼 수 있음 (`ls`) |
| **w** | 2 | 내용을 수정/삭제할 수 있음 | 디렉토리 내 파일 생성/삭제 가능 |
| **x** | 1 | 실행 파일로서 실행 가능 (`./file`) | **디렉토리 내부로 진입 가능 (`cd`)** |

> **💡 Security Tip:** 웹 서버 설정 시 업로드 폴더에 `x` 권한이 있으면, 공격자가 웹쉘(Webshell)을 업로드하고 실행할 수 있게 된다. 따라서 업로드 경로는 반드시 실행 권한을 제거해야 한다.

---

## 2. Octal Notation (8진수 표기법)

`rwx` 문자를 숫자로 환산하여 권한을 설정한다. (r=4, w=2, x=1)

* **7 (4+2+1):** 읽기, 쓰기, 실행 (Full Access)
* **5 (4+0+1):** 읽기, 실행 (수정 불가)
* **4 (4+0+0):** 읽기 전용 (Read Only)
* **0 (0+0+0):** 권한 없음

### 자주 쓰이는 권한 설정
* **755 (`rwxr-xr-x`):** 소유자는 다 하고, 나머지는 읽고 실행만. (일반적인 실행 파일/스크립트)
* **644 (`rw-r--r--`):** 소유자는 읽고 쓰고, 나머지는 읽기만. (일반적인 문서, 설정 파일)
* **600 (`rw-------`):** **[중요]** 소유자만 읽고 쓸 수 있음. (SSH 개인키 `id_rsa`, 비밀번호 파일 등)

---

## 3. Special Permissions (특수 권한)

**[Privilege Escalation의 핵심]**
기본 권한 외에 특수한 기능을 부여하는 3가지 비트.

### 1) SetUID (SUID) - `4000`
* **표기:** 소유자 권한의 `x` 자리에 **`s`**가 붙음 (`rwsr-xr-x`).
* **기능:** **파일을 실행하는 동안, 실행시킨 사용자가 아닌 '파일 소유자'의 권한으로 실행된다.**
* **보안 위험:** 만약 `root` 소유의 파일에 SUID가 걸려있다면, 일반 유저가 이를 실행하는 순간 **root 권한**을 갖게 된다.
    * 예: `/usr/bin/passwd` (일반 유저가 내 암호를 바꿀 때 `/etc/shadow`를 수정해야 하므로 필요함)
    * **Attack Vector:** 관리자가 실수로 `Python`, `Perl`, `Vim` 등에 SUID를 걸어두면, 공격자는 이를 이용해 루트 쉘을 획득할 수 있다. (참고: GTFOBins)

### 2) SetGID (SGID) - `2000`
* **표기:** 그룹 권한의 `x` 자리에 **`s`**가 붙음 (`rwxr-sr-x`).
* **기능:** 실행 시 파일 소유 그룹의 권한을 가짐. 디렉토리에 설정 시, 그 안에 생성되는 파일들은 상위 디렉토리의 그룹을 상속받음.

### 3) Sticky Bit - `1000`
* **표기:** 기타(Others) 권한의 `x` 자리에 **`t`**가 붙음 (`rwxrwxrwt`).
* **기능:** 누구나 파일을 생성할 수 있지만, **삭제는 '파일 소유자'와 '디렉토리 소유자'만 가능하다.**
* **예시:** `/tmp` 디렉토리 (누구나 쓸 수 있지만, 남의 파일은 못 지우게 함).

---

## 4. Commands (관리 명령어)

### `chmod` (Change Mode)
권한을 변경한다.
* `chmod 755 file.sh`: 숫자로 설정.
* `chmod u+x file.sh`: 사용자(u)에게 실행(x) 권한 추가.
* `chmod -R 777 directory`: 하위 폴더까지 재귀적으로 변경 (위험).

### `chown` (Change Owner)
소유자와 소유 그룹을 변경한다. (보통 root 권한 필요)
* `chown user:group file`
* `chown -R user:group directory`

### `umask`
파일 생성 시 기본적으로 **제외할** 권한을 지정한다.
* 보통 `0022` 혹은 `0002`로 설정됨.
* 파일 생성 기본 권한(666) - umask(022) = `644`가 됨.

---

## 5. Advanced & Anti-Forensics

단순 권한 외에, 파일의 속성을 제어하여 삭제나 수정을 막는 기법. 악성코드나 백도어가 자주 사용한다.

### `chattr` & `lsattr` (Change/List Attributes)
* **`chattr +i filename` (Immutable):**
    * 파일을 **불변** 상태로 만든다.
    * **Root조차도** 파일을 삭제, 수정, 이름 변경, 링크 생성을 할 수 없다.
    * 해제하려면 `chattr -i filename`을 해야 함.
* **`chattr +a filename` (Append Only):**
    * 기존 내용을 지우지 못하고, 내용 **추가**만 가능하다. (로그 파일 보호 목적)

> **💡 Incident Response Tip:** 해킹 당한 시스템에서 명백한 악성 파일이 `rm`으로 안 지워진다면 100% `chattr +i`가 걸려있는 것이다. `lsattr`로 확인해보자.
